<!DOCTYPE html>
<html>
<head>
    <title>üè™ CC-Shop Finanzsystem</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #0f172a; color: white; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        
        .header { 
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .config-box {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #334155;
        }
        
        input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            font-size: 16px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: 0.3s;
        }
        
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .btn-save { background: #10b981; }
        .btn-load { background: #3b82f6; }
        .btn-hold { background: #8b5cf6; }
        .btn-deposit { background: #22c55e; }
        .btn-withdraw { background: #ef4444; }
        
        .balance-box {
            background: #1e293b;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid #475569;
        }
        
        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            color: #fbbf24;
            margin: 20px 0;
        }
        
        .log-box {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #334155;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .success { color: #10b981; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè™ CC-SHOP FINANZSYSTEM</h1>
            <p>‚òÅÔ∏è Daten werden auf GitHub gespeichert</p>
        </div>
        
        <!-- Configuration -->
        <div class="config-box">
            <h3>‚öôÔ∏è GitHub Konfiguration:</h3>
            
            <!-- √ÑNDERE DIESE ZEILE: Ersetze "DEIN-USERNAME" -->
            <input type="text" id="githubUser" 
                   placeholder="Dein GitHub Username" 
                   value="DEIN-USERNAME">
            
            <input type="text" id="repoName" 
                   placeholder="Repository Name" 
                   value="ccshop-finanz">
            
            <input type="password" id="githubToken" 
                   placeholder="GitHub Token" 
                   value="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">
            
            <button class="btn-save" onclick="saveConfig()">
                ‚úÖ Konfiguration speichern
            </button>
            
            <div style="margin-top: 15px; padding: 10px; background: #0f172a; border-radius: 8px;">
                <small>üîó Repository URL:</small>
                <div id="repoUrl" style="color: #60a5fa; word-break: break-all;"></div>
            </div>
        </div>
        
        <!-- Balance -->
        <div class="balance-box">
            <h2>üí∞ VERF√úGBARES GUTHABEN</h2>
            <div class="balance-amount" id="balance">0 ‚Ç¨</div>
            <div id="status">üî¥ Nicht verbunden</div>
        </div>
        
        <!-- Action Buttons -->
        <button class="btn-load" onclick="loadFromGitHub()">
            üì• VON GITHUB LADEN
        </button>
        
        <button class="btn-save" onclick="saveToGitHub()">
            üì§ ZU GITHUB SPEICHERN
        </button>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
            <button class="btn-hold" onclick="addHold(100)">
                ‚è∏Ô∏è 100‚Ç¨ zur√ºckhalten
            </button>
            <button class="btn-deposit" onclick="addDeposit(500)">
                ‚ûï 500‚Ç¨ einzahlen
            </button>
            <button class="btn-withdraw" onclick="addWithdraw(200)">
                ‚ûñ 200‚Ç¨ auszahlen
            </button>
        </div>
        
        <!-- Debug Info -->
        <button onclick="testConnection()" style="background: #f59e0b;">
            üîß Verbindung testen
        </button>
        
        <!-- Log -->
        <div class="log-box">
            <h3>üìù AKTIVIT√ÑTS-LOG:</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        // ==================== KONFIGURATION ====================
        // DEINE DATEN - √ÑNDERE HIER!
        const DEFAULT_CONFIG = {
            githubUser: "FreedomWorld1",  // √ÑNDERN! Dein GitHub Username
            repoName: "ccshop-finanz",    // Repository Name
            githubToken: "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"  // Dein Token
        };
        
        // ==================== DATENBANK ====================
        let database = {
            balance: 0,
            transactions: [],
            lastUpdated: new Date().toISOString(),
            version: "1.0"
        };
        
        // ==================== HELPER FUNCTIONS ====================
        function log(message, type = "info") {
            const logDiv = document.getElementById("log");
            const time = new Date().toLocaleTimeString("de-DE");
            const entry = document.createElement("div");
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type}]`, message);
        }
        
        function updateDisplay() {
            document.getElementById("balance").textContent = `${database.balance} ‚Ç¨`;
            document.getElementById("status").textContent = 
                `üîÑ Zuletzt: ${new Date(database.lastUpdated).toLocaleTimeString("de-DE")}`;
            document.getElementById("status").style.color = "#10b981";
        }
        
        function updateRepoUrl() {
            const user = document.getElementById("githubUser").value;
            const repo = document.getElementById("repoName").value;
            document.getElementById("repoUrl").innerHTML = 
                `üåê <a href="https://github.com/${user}/${repo}" target="_blank" style="color:#60a5fa;">
                https://github.com/${user}/${repo}</a>`;
        }
        
        // ==================== GITHUB FUNKTIONEN ====================
        async function githubRequest(url, method = "GET", body = null) {
            const token = document.getElementById("githubToken").value;
            
            const options = {
                method: method,
                headers: {
                    "Authorization": `token ${token}`,
                    "Accept": "application/vnd.github.v3+json",
                    "Content-Type": "application/json"
                }
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            try {
                const response = await fetch(url, options);
                
                if (response.status === 404) {
                    return { error: "NOT_FOUND", status: 404 };
                }
                
                if (!response.ok) {
                    throw new Error(`GitHub Fehler ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                log(`‚ùå Netzwerkfehler: ${error.message}`, "error");
                throw error;
            }
        }
        
        async function loadFromGitHub() {
            const user = document.getElementById("githubUser").value;
            const repo = document.getElementById("repoName").value;
            
            if (!user || !repo) {
                log("‚ùå Bitte GitHub User und Repository eingeben!", "error");
                return;
            }
            
            try {
                log("üì• Lade Daten von GitHub...", "info");
                
                const url = `https://api.github.com/repos/${user}/${repo}/contents/data.json`;
                const result = await githubRequest(url);
                
                if (result.error === "NOT_FOUND") {
                    log("‚ö†Ô∏è Keine Daten gefunden. Erstelle neue Datenbank...", "info");
                    database = {
                        balance: 1000,
                        transactions: [],
                        lastUpdated: new Date().toISOString(),
                        version: "1.0"
                    };
                    updateDisplay();
                    log("‚úÖ Neue Datenbank erstellt mit 1000‚Ç¨ Startguthaben", "success");
                    return;
                }
                
                // Base64 dekodieren
                const content = atob(result.content);
                database = JSON.parse(content);
                
                log(`‚úÖ Daten geladen: ${database.balance}‚Ç¨ Guthaben`, "success");
                log(`üìä ${database.transactions.length} Transaktionen`, "info");
                updateDisplay();
                
            } catch (error) {
                log(`‚ùå Fehler beim Laden: ${error.message}`, "error");
            }
        }
        
        async function saveToGitHub() {
            const user = document.getElementById("githubUser").value;
            const repo = document.getElementById("repoName").value;
            
            if (!user || !repo) {
                log("‚ùå Bitte GitHub User und Repository eingeben!", "error");
                return;
            }
            
            try {
                log("üì§ Speichere Daten zu GitHub...", "info");
                
                // SHA der existierenden Datei holen
                const getUrl = `https://api.github.com/repos/${user}/${repo}/contents/data.json`;
                let sha = null;
                
                try {
                    const existing = await githubRequest(getUrl);
                    if (existing && !existing.error) {
                        sha = existing.sha;
                    }
                } catch (e) {
                    // Datei existiert nicht, das ist OK
                }
                
                // Daten aktualisieren
                database.lastUpdated = new Date().toISOString();
                const content = JSON.stringify(database, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                // Hochladen
                const putData = {
                    message: `CC-Shop Update: ${new Date().toLocaleString("de-DE")}`,
                    content: encodedContent
                };
                
                if (sha) {
                    putData.sha = sha;
                }
                
                const result = await githubRequest(getUrl, "PUT", putData);
                
                log("‚úÖ Daten erfolgreich auf GitHub gespeichert!", "success");
                log(`üîó Commit: ${result.commit.html_url}`, "info");
                updateDisplay();
                
            } catch (error) {
                log(`‚ùå Fehler beim Speichern: ${error.message}`, "error");
            }
        }
        
        async function testConnection() {
            const user = document.getElementById("githubUser").value;
            const repo = document.getElementById("repoName").value;
            
            if (!user || !repo) {
                alert("‚ùå Bitte User und Repository eingeben!");
                return;
            }
            
            try {
                log("üîß Teste GitHub Verbindung...", "info");
                
                // Teste ob Repository existiert
                const url = `https://api.github.com/repos/${user}/${repo}`;
                const result = await githubRequest(url);
                
                if (result.error === "NOT_FOUND") {
                    log("‚ö†Ô∏è Repository nicht gefunden. Erstelle es auf GitHub!", "error");
                    alert(`‚ùå Repository nicht gefunden!\n\nErstelle zuerst:\nhttps://github.com/new\n\nName: ${repo}`);
                } else {
                    log("‚úÖ Repository gefunden!", "success");
                    log(`üìÅ Repository: ${result.full_name}`, "info");
                    log(`üìÖ Erstellt: ${result.created_at}`, "info");
                    alert(`‚úÖ Verbindung OK!\n\nRepository: ${result.full_name}\n\nJetzt "Von GitHub laden" klicken!`);
                }
                
            } catch (error) {
                log(`‚ùå Verbindungstest fehlgeschlagen: ${error.message}`, "error");
                alert(`‚ùå Fehler: ${error.message}\n\n1. Pr√ºfe ob Repository existiert\n2. Pr√ºfe ob Token korrekt ist`);
            }
        }
        
        // ==================== FINANZ FUNKTIONEN ====================
        function addHold(amount) {
            const today = new Date();
            const releaseDate = new Date(today);
            releaseDate.setDate(releaseDate.getDate() + 2);
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: "hold",
                status: "pending",
                date: today.toLocaleDateString("de-DE"),
                purchaseDate: today.toISOString().split("T")[0],
                releaseDate: releaseDate.toISOString().split("T")[0],
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`‚úÖ ${amount}‚Ç¨ zur√ºckgehalten (Freigabe: ${releaseDate.toLocaleDateString("de-DE")})`, "success");
            updateDisplay();
            saveToGitHub();
        }
        
        function addDeposit(amount) {
            database.balance += amount;
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: "deposit",
                status: "released",
                date: new Date().toLocaleDateString("de-DE"),
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`‚úÖ ${amount}‚Ç¨ eingezahlt. Neues Guthaben: ${database.balance}‚Ç¨`, "success");
            updateDisplay();
            saveToGitHub();
        }
        
        function addWithdraw(amount) {
            if (amount > database.balance) {
                log(`‚ùå Nicht genug Guthaben! Verf√ºgbar: ${database.balance}‚Ç¨`, "error");
                alert(`‚ùå Nicht genug Guthaben!\nVerf√ºgbar: ${database.balance}‚Ç¨`);
                return;
            }
            
            database.balance -= amount;
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: "withdrawal",
                status: "released",
                date: new Date().toLocaleDateString("de-DE"),
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`‚úÖ ${amount}‚Ç¨ ausgezahlt. Neues Guthaben: ${database.balance}‚Ç¨`, "success");
            updateDisplay();
            saveToGitHub();
        }
        
        function saveConfig() {
            localStorage.setItem("ccshop_github_user", document.getElementById("githubUser").value);
            localStorage.setItem("ccshop_repo_name", document.getElementById("repoName").value);
            localStorage.setItem("ccshop_github_token", document.getElementById("githubToken").value);
            log("‚úÖ Konfiguration gespeichert", "success");
            updateRepoUrl();
        }
        
        // ==================== INITIALISIERUNG ====================
        function init() {
            log("üöÄ CC-Shop Finanzsystem gestartet", "info");
            
            // Config laden
            const savedUser = localStorage.getItem("ccshop_github_user") || DEFAULT_CONFIG.githubUser;
            const savedRepo = localStorage.getItem("ccshop_repo_name") || DEFAULT_CONFIG.repoName;
            const savedToken = localStorage.getItem("ccshop_github_token") || DEFAULT_CONFIG.githubToken;
            
            document.getElementById("githubUser").value = savedUser;
            document.getElementById("repoName").value = savedRepo;
            document.getElementById("githubToken").value = savedToken;
            
            updateRepoUrl();
            updateDisplay();
            
            // Automatisch alle 3 Minuten speichern
            setInterval(() => {
                if (document.getElementById("githubUser").value) {
                    saveToGitHub();
                }
            }, 3 * 60 * 1000);
            
            log("‚úÖ System bereit. Klicke 'Von GitHub laden'", "success");
        }
        
        // Starte das System
        init();
    </script>
</body>
</html>
