<!DOCTYPE html>
<html>
<head>
    <title>üè™ CC-Shop Finanzsystem</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white; 
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 800px; margin: 0 auto; }
        
        .header { 
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        
        .config-card {
            background: rgba(30, 41, 59, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #334155;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #94a3b8;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: 2px solid #334155;
            background: rgba(15, 23, 42, 0.8);
            color: white;
            font-size: 16px;
        }
        
        input:focus {
            outline: none;
            border-color: #8b5cf6;
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            width: 100%;
            margin: 8px 0;
        }
        
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-purple { background: #8b5cf6; color: white; }
        
        .balance-card {
            background: rgba(30, 41, 59, 0.9);
            padding: 35px;
            border-radius: 15px;
            text-align: center;
            margin: 25px 0;
            border: 2px solid #475569;
        }
        
        .balance-amount {
            font-size: 3.5rem;
            font-weight: bold;
            color: #fbbf24;
            margin: 20px 0;
        }
        
        .action-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .action-btn {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .log-container {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
        }
        
        .log-entry {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .log-success { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .log-error { background: rgba(239, 68, 68, 0.15); color: #f87171; }
        .log-info { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
        .log-warning { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        
        .transaction-item {
            background: rgba(30, 41, 59, 0.6);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-store"></i> CC-SHOP FINANZSYSTEM</h1>
            <p>Sichere Version - Token wird NIE im Code gespeichert</p>
            <div style="margin-top: 15px; font-size: 0.9rem; color: #cbd5e0;">
                Status: <span id="statusText">Bitte Token eingeben</span>
            </div>
        </div>
        
        <!-- Configuration -->
        <div class="config-card">
            <h3 style="color: #60a5fa; margin-bottom: 20px;">
                <i class="fas fa-cog"></i> GitHub Konfiguration
            </h3>
            
            <div class="input-group">
                <label><i class="fas fa-user"></i> GitHub Benutzername</label>
                <input type="text" id="githubUser" value="FreedomWorld1" readonly>
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-database"></i> Repository Name</label>
                <input type="text" id="repoName" value="ccshop-finanz">
            </div>
            
            <div class="input-group">
                <label><i class="fas fa-key"></i> GitHub Personal Access Token</label>
                <input type="password" id="githubToken" 
                       placeholder="Token hier eingeben (beginnt mit ghp_)"
                       autocomplete="off">
                <div style="margin-top: 8px;">
                    <a href="https://github.com/settings/tokens" target="_blank" 
                       style="color: #60a5fa; font-size: 0.9rem; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i> Token erstellen/verwalten
                    </a>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="testConnection()">
                <i class="fas fa-bolt"></i> Verbindung testen
            </button>
            
            <button class="btn btn-success" onclick="saveConfig()">
                <i class="fas fa-save"></i> Einstellungen speichern
            </button>
            
            <div id="connectionInfo" style="margin-top: 20px; padding: 15px; background: rgba(15, 23, 42, 0.6); border-radius: 10px;">
                <div style="color: #94a3b8;">
                    <i class="fas fa-info-circle"></i> Noch nicht verbunden
                </div>
            </div>
        </div>
        
        <!-- Repository Management -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0;">
            <button class="btn btn-warning" onclick="createRepository()">
                <i class="fas fa-plus-circle"></i> Repository erstellen
            </button>
            <button class="btn btn-warning" onclick="openRepository()">
                <i class="fas fa-external-link-alt"></i> Repository √∂ffnen
            </button>
        </div>
        
        <!-- Balance -->
        <div class="balance-card">
            <h2 style="color: #60a5fa; margin-bottom: 15px;">GUTHABEN</h2>
            <div class="balance-amount" id="balance">0 ‚Ç¨</div>
            <div style="color: #94a3b8;">
                <i class="fas fa-sync-alt"></i> Letzte Aktualisierung: 
                <span id="lastSync">-</span>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;">
                <button class="btn btn-primary" onclick="loadFromGitHub()">
                    <i class="fas fa-download"></i> Laden
                </button>
                <button class="btn btn-success" onclick="saveToGitHub()">
                    <i class="fas fa-upload"></i> Speichern
                </button>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="action-grid">
            <button class="btn btn-purple action-btn" onclick="addHold(100)">
                <i class="fas fa-pause-circle"></i>
                <span>100‚Ç¨ halten</span>
            </button>
            <button class="btn btn-success action-btn" onclick="addDeposit(500)">
                <i class="fas fa-plus-circle"></i>
                <span>500‚Ç¨ einzahlen</span>
            </button>
            <button class="btn btn-danger action-btn" onclick="addWithdraw(200)">
                <i class="fas fa-minus-circle"></i>
                <span>200‚Ç¨ auszahlen</span>
            </button>
        </div>
        
        <!-- Transaction History -->
        <div class="config-card">
            <h3 style="color: #60a5fa; margin-bottom: 15px;">
                <i class="fas fa-history"></i> Letzte Transaktionen
            </h3>
            <div id="transactionList">
                <div style="text-align: center; padding: 30px; color: #94a3b8;">
                    <i class="fas fa-clock" style="font-size: 2rem;"></i>
                    <p>Keine Transaktionen</p>
                </div>
            </div>
        </div>
        
        <!-- System Log -->
        <div class="log-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: #60a5fa;">
                    <i class="fas fa-terminal"></i> System Log
                </h3>
                <button onclick="clearLog()" style="background: #475569; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                    <i class="fas fa-trash"></i> L√∂schen
                </button>
            </div>
            <div id="log"></div>
        </div>
    </div>

    <script>
        // ==================== KONSTANTEN ====================
        const GITHUB_USER = "FreedomWorld1";
        const DEFAULT_REPO = "ccshop-finanz";
        
        // ==================== DATENBANK ====================
        let database = {
            balance: 0,
            transactions: [],
            lastUpdated: new Date().toISOString()
        };
        
        // ==================== HELPER FUNKTIONEN ====================
        function log(message, type = "info") {
            const logDiv = document.getElementById("log");
            const time = new Date().toLocaleTimeString("de-DE");
            const entry = document.createElement("div");
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type}] ${message}`);
        }
        
        function updateStatus(text) {
            const statusElement = document.getElementById("statusText");
            if (statusElement) {
                statusElement.textContent = text;
            }
        }
        
        function updateDisplay() {
            // Balance aktualisieren
            const balanceElement = document.getElementById("balance");
            const lastSyncElement = document.getElementById("lastSync");
            
            if (balanceElement) {
                balanceElement.textContent = `${database.balance} ‚Ç¨`;
            }
            
            if (lastSyncElement) {
                lastSyncElement.textContent = 
                    new Date(database.lastUpdated).toLocaleTimeString("de-DE");
            }
            
            // Transaktionen aktualisieren
            const transactionList = document.getElementById("transactionList");
            if (!transactionList) return;
            
            const transactions = database.transactions.slice(-5).reverse();
            
            if (transactions.length === 0) {
                transactionList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #94a3b8;">
                        <i class="fas fa-clock" style="font-size: 2rem;"></i>
                        <p>Keine Transaktionen</p>
                    </div>
                `;
                return;
            }
            
            transactionList.innerHTML = '';
            
            transactions.forEach(trans => {
                const div = document.createElement("div");
                div.className = "transaction-item";
                
                const typeIcon = trans.type === 'hold' ? '‚è∏Ô∏è' : 
                               trans.type === 'deposit' ? '‚ûï' : '‚ûñ';
                
                const borderColor = trans.type === 'hold' ? '#8b5cf6' : 
                                  trans.type === 'deposit' ? '#10b981' : '#ef4444';
                
                div.style.borderLeftColor = borderColor;
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 1.2rem; font-weight: bold;">${typeIcon} ${trans.amount}‚Ç¨</span>
                            <div style="color: #94a3b8; font-size: 0.85rem; margin-top: 4px;">
                                ${trans.date || ''}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #cbd5e0;">${trans.type}</div>
                            ${trans.releaseDate ? `
                                <div style="color: #94a3b8; font-size: 0.8rem;">
                                    Freigabe: ${trans.releaseDate}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                transactionList.appendChild(div);
            });
        }
        
        // ==================== TOKEN MANAGEMENT ====================
        function getToken() {
            const tokenInput = document.getElementById("githubToken");
            if (!tokenInput) {
                throw new Error("Token Eingabefeld nicht gefunden");
            }
            
            const token = tokenInput.value.trim();
            
            if (!token) {
                throw new Error("Bitte GitHub Token eingeben!");
            }
            
            if (!token.startsWith("ghp_")) {
                throw new Error("Token muss mit 'ghp_' beginnen!");
            }
            
            return token;
        }
        
        function getConfig() {
            const userInput = document.getElementById("githubUser");
            const repoInput = document.getElementById("repoName");
            
            if (!userInput || !repoInput) {
                throw new Error("Konfigurationsfelder nicht gefunden");
            }
            
            const user = userInput.value.trim();
            const repo = repoInput.value.trim();
            const token = getToken();
            
            if (!user || !repo) {
                throw new Error("Bitte Benutzername und Repository eingeben!");
            }
            
            return { user, repo, token };
        }
        
        // ==================== GITHUB FUNKTIONEN ====================
        async function testConnection() {
            try {
                updateStatus("Verbindung wird getestet...");
                log("Teste GitHub Verbindung...", "info");
                
                const config = getConfig();
                const token = config.token;
                
                // 1. Token validieren
                const userResponse = await fetch("https://api.github.com/user", {
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Accept": "application/vnd.github.v3+json"
                    }
                });
                
                if (userResponse.status === 401) {
                    throw new Error("Token ung√ºltig oder abgelaufen! Erstelle neuen Token.");
                }
                
                if (!userResponse.ok) {
                    throw new Error(`Token-Fehler ${userResponse.status}`);
                }
                
                const userData = await userResponse.json();
                log(`‚úÖ Token g√ºltig f√ºr: ${userData.login}`, "success");
                
                // 2. Repository pr√ºfen
                const repoResponse = await fetch(`https://api.github.com/repos/${config.user}/${config.repo}`, {
                    headers: { "Authorization": `Bearer ${token}` }
                });
                
                if (repoResponse.ok) {
                    const repoData = await repoResponse.json();
                    log(`‚úÖ Repository gefunden: ${repoData.full_name}`, "success");
                    updateStatus(`Verbunden: ${repoData.full_name}`);
                    
                    const connectionInfo = document.getElementById("connectionInfo");
                    if (connectionInfo) {
                        connectionInfo.innerHTML = `
                            <div style="color: #10b981;">
                                <i class="fas fa-check-circle"></i>
                                Verbunden mit <strong>${repoData.full_name}</strong>
                                <div style="margin-top: 8px; font-size: 0.9rem;">
                                    <a href="${repoData.html_url}" target="_blank" style="color: #60a5fa;">
                                        <i class="fas fa-external-link-alt"></i> Repository √∂ffnen
                                    </a>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Daten automatisch laden
                    setTimeout(() => loadFromGitHub(), 1000);
                    
                } else if (repoResponse.status === 404) {
                    log(`‚ö†Ô∏è Repository "${config.repo}" nicht gefunden`, "warning");
                    updateStatus(`Repository nicht gefunden`);
                    
                    const connectionInfo = document.getElementById("connectionInfo");
                    if (connectionInfo) {
                        connectionInfo.innerHTML = `
                            <div style="color: #f59e0b;">
                                <i class="fas fa-exclamation-triangle"></i>
                                Repository "${config.repo}" nicht gefunden
                                <div style="margin-top: 8px;">
                                    <button onclick="createRepository()" style="background: #f59e0b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                        <i class="fas fa-plus-circle"></i> Jetzt erstellen
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                    
                } else {
                    throw new Error(`Repository-Fehler ${repoResponse.status}`);
                }
                
            } catch (error) {
                log(`‚ùå Verbindungstest fehlgeschlagen: ${error.message}`, "error");
                updateStatus("Verbindung fehlgeschlagen");
                
                const connectionInfo = document.getElementById("connectionInfo");
                if (connectionInfo) {
                    connectionInfo.innerHTML = `
                        <div style="color: #f87171;">
                            <i class="fas fa-times-circle"></i>
                            ${error.message}
                        </div>
                    `;
                }
                
                if (error.message.includes("401")) {
                    alert(`‚ùå TOKEN PROBLEM!\n\n${error.message}\n\nErstelle neuen Token unter:\ngithub.com/settings/tokens\n\nScopes: NUR "repo" ausw√§hlen`);
                }
            }
        }
        
        async function loadFromGitHub() {
            try {
                updateStatus("Daten werden geladen...");
                log("Lade Daten von GitHub...", "info");
                
                const config = getConfig();
                
                const response = await fetch(`https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`, {
                    headers: {
                        "Authorization": `Bearer ${config.token}`,
                        "Accept": "application/vnd.github.v3+json"
                    }
                });
                
                if (response.status === 404) {
                    log("‚ö†Ô∏è Keine Daten gefunden. Erstelle neue Datenbank...", "info");
                    
                    database = {
                        balance: 5000,
                        transactions: [{
                            id: Date.now(),
                            amount: 5000,
                            type: "deposit",
                            status: "released",
                            date: new Date().toISOString().split("T")[0],
                            createdAt: new Date().toISOString(),
                            description: "Startguthaben"
                        }],
                        lastUpdated: new Date().toISOString()
                    };
                    
                    log("‚úÖ Neue Datenbank mit 5.000‚Ç¨ Startguthaben", "success");
                    updateDisplay();
                    updateStatus("Neue Datenbank erstellt");
                    
                    // Automatisch speichern
                    setTimeout(() => saveToGitHub(), 1500);
                    return;
                }
                
                if (!response.ok) {
                    throw new Error(`Ladefehler ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const content = atob(data.content);
                database = JSON.parse(content);
                
                log(`‚úÖ Daten geladen: ${database.balance}‚Ç¨`, "success");
                log(`üìä ${database.transactions.length} Transaktionen`, "info");
                
                updateDisplay();
                updateStatus(`Daten geladen ‚Ä¢ ${database.balance}‚Ç¨`);
                
            } catch (error) {
                log(`‚ùå Fehler beim Laden: ${error.message}`, "error");
                updateStatus("Ladefehler");
            }
        }
        
        async function saveToGitHub() {
            try {
                updateStatus("Daten werden gespeichert...");
                log("Speichere Daten zu GitHub...", "info");
                
                const config = getConfig();
                
                // Aktuelle SHA holen
                let sha = null;
                try {
                    const existing = await fetch(`https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`, {
                        headers: { "Authorization": `Bearer ${config.token}` }
                    });
                    
                    if (existing.ok) {
                        const existingData = await existing.json();
                        sha = existingData.sha;
                    }
                } catch (e) {
                    // Datei existiert nicht
                }
                
                // Daten aktualisieren
                database.lastUpdated = new Date().toISOString();
                const content = JSON.stringify(database, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                // Hochladen
                const putData = {
                    message: `CC-Shop Update: ${new Date().toLocaleString("de-DE")}`,
                    content: encodedContent
                };
                
                if (sha) {
                    putData.sha = sha;
                }
                
                const response = await fetch(`https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`, {
                    method: "PUT",
                    headers: {
                        "Authorization": `Bearer ${config.token}`,
                        "Accept": "application/vnd.github.v3+json",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(putData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Speicherfehler ${response.status}: ${errorText}`);
                }
                
                log("‚úÖ Daten erfolgreich gespeichert!", "success");
                updateDisplay();
                updateStatus(`Gespeichert ‚Ä¢ ${new Date().toLocaleTimeString("de-DE")}`);
                
            } catch (error) {
                log(`‚ùå Fehler beim Speichern: ${error.message}`, "error");
                updateStatus("Speicherfehler");
            }
        }
        
        // ==================== FINANZ FUNKTIONEN ====================
        function addHold(amount) {
            if (!amount || amount <= 0) {
                log("‚ùå Ung√ºltiger Betrag", "error");
                return;
            }
            
            const today = new Date();
            const releaseDate = new Date(today);
            releaseDate.setDate(releaseDate.getDate() + 2);
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: "hold",
                status: "pending",
                date: today.toISOString().split("T")[0],
                releaseDate: releaseDate.toISOString().split("T")[0],
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`‚úÖ ${amount}‚Ç¨ zur√ºckgehalten (Freigabe: ${releaseDate.toLocaleDateString("de-DE")})`, "success");
            updateDisplay();
            
            // Automatisch speichern
            setTimeout(() => saveToGitHub(), 500);
        }
        
        function addDeposit(amount) {
            if (!amount || amount <= 0) {
                log("‚ùå Ung√ºltiger Betrag", "error");
                return;
            }
            
            database.balance += amount;
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: "deposit",
                status: "released",
                date: new Date().toISOString().split("T")[0],
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`‚úÖ ${amount}‚Ç¨ eingezahlt. Neues Guthaben: ${database.balance}‚Ç¨`, "success");
            updateDisplay();
            
            // Automatisch speichern
            setTimeout(() => saveToGitHub(), 500);
        }
        
        function addWithdraw(amount) {
            if (!amount || amount <= 0) {
                log("‚ùå Ung√ºltiger Betrag", "error");
                return;
            }
            
            if (amount > database.balance) {
                log(`‚ùå Nicht genug Guthaben! Verf√ºgbar: ${database.balance}‚Ç¨`, "error");
                alert(`‚ùå Nicht genug Guthaben!\nVerf√ºgbar: ${database.balance}‚Ç¨`);
                return;
            }
            
            database.balance -= amount;
            
            const transaction = {
                id: Date.now(),
                amount: amount,
                type: "withdrawal",
                status: "released",
                date: new Date().toISOString().split("T")[0],
                createdAt: new Date().toISOString()
            };
            
            database.transactions.push(transaction);
            log(`‚úÖ ${amount}‚Ç¨ ausgezahlt. Neues Guthaben: ${database.balance}‚Ç¨`, "success");
            updateDisplay();
            
            // Automatisch speichern
            setTimeout(() => saveToGitHub(), 500);
        }
        
        // ==================== HELPER FUNKTIONEN ====================
        function createRepository() {
            const userInput = document.getElementById("githubUser");
            const repoInput = document.getElementById("repoName");
            
            if (!userInput || !repoInput) {
                alert("Konfigurationsfelder nicht gefunden!");
                return;
            }
            
            const user = userInput.value.trim();
            const repo = repoInput.value.trim();
            
            if (!user) {
                alert("Bitte erst GitHub Username eingeben!");
                return;
            }
            
            const url = `https://github.com/new?name=${repo || DEFAULT_REPO}`;
            window.open(url, "_blank");
            log(`üåê Repository Erstellung ge√∂ffnet: ${url}`, "info");
        }
        
        function openRepository() {
            const userInput = document.getElementById("githubUser");
            const repoInput = document.getElementById("repoName");
            
            if (!userInput || !repoInput) {
                alert("Konfigurationsfelder nicht gefunden!");
                return;
            }
            
            const user = userInput.value.trim();
            const repo = repoInput.value.trim();
            
            if (!user || !repo) {
                alert("Bitte Username und Repository eingeben!");
                return;
            }
            
            const url = `https://github.com/${user}/${repo}`;
            window.open(url, "_blank");
        }
        
        function saveConfig() {
            const userInput = document.getElementById("githubUser");
            const repoInput = document.getElementById("repoName");
            
            if (!userInput || !repoInput) {
                alert("Konfigurationsfelder nicht gefunden!");
                return;
            }
            
            const user = userInput.value.trim();
            const repo = repoInput.value.trim();
            
            if (!user || !repo) {
                alert("Bitte alle Felder ausf√ºllen!");
                return;
            }
            
            // WICHTIG: Token wird NICHT gespeichert!
            localStorage.setItem("ccshop_user", user);
            localStorage.setItem("ccshop_repo", repo);
            
            log("‚úÖ Einstellungen gespeichert (Token wird NICHT gespeichert)", "success");
        }
        
        function clearLog() {
            const logDiv = document.getElementById("log");
            if (logDiv) {
                logDiv.innerHTML = '';
                log("Log wurde geleert", "info");
            }
        }
        
        // ==================== INITIALISIERUNG ====================
        function init() {
            log("üöÄ CC-Shop Finanzsystem gestartet", "info");
            
            // Gespeicherte Einstellungen laden
            try {
                const savedUser = localStorage.getItem("ccshop_user") || GITHUB_USER;
                const savedRepo = localStorage.getItem("ccshop_repo") || DEFAULT_REPO;
                
                const userInput = document.getElementById("githubUser");
                const repoInput = document.getElementById("repoName");
                
                if (userInput && repoInput) {
                    userInput.value = savedUser;
                    repoInput.value = savedRepo;
                }
                
                log(`üë§ Eingestellter User: ${savedUser}`, "info");
                log(`üìÅ Repository: ${savedRepo}`, "info");
                
            } catch (error) {
                log("‚ö†Ô∏è Fehler beim Laden der gespeicherten Einstellungen", "warning");
            }
            
            // Token Feld leer lassen - muss immer neu eingegeben werden!
            updateDisplay();
            updateStatus("Bitte Token eingeben und 'Verbindung testen'");
            
            log("üîë Token muss manuell eingegeben werden", "warning");
            
            // Auto-save alle 3 Minuten
            setInterval(() => {
                const tokenInput = document.getElementById("githubToken");
                if (tokenInput && tokenInput.value.trim() !== "" && database.transactions.length > 0) {
                    saveToGitHub();
                }
            }, 3 * 60 * 1000);
        }
        
        // Starte das System
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
